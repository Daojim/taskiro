<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Timezone Frontend Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      .result {
        margin: 10px 0;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 3px;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <h1>Frontend Timezone Handling Test</h1>

    <div class="test-section">
      <h2>User Timezone Detection</h2>
      <div class="result" id="timezone-result"></div>
    </div>

    <div class="test-section">
      <h2>Date Formatting Without Timezone Conversion</h2>
      <div class="result" id="date-format-result"></div>
    </div>

    <div class="test-section">
      <h2>Calendar Date Matching</h2>
      <div class="result" id="calendar-match-result"></div>
    </div>

    <div class="test-section">
      <h2>Task Date Parsing</h2>
      <div class="result" id="task-parse-result"></div>
    </div>

    <script>
      // Test 1: User timezone detection
      function testTimezoneDetection() {
        const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        document.getElementById('timezone-result').innerHTML = `
                <strong>Detected Timezone:</strong> ${userTimezone}<br>
                <strong>Current Time:</strong> ${new Date().toLocaleString()}<br>
                <strong>UTC Time:</strong> ${new Date().toISOString()}
            `;
      }

      // Test 2: Date formatting without timezone conversion (mimicking our fixes)
      function testDateFormatting() {
        const testDates = ['2024-01-15', '2024-12-25', '2024-06-30'];

        let results =
          '<strong>Testing YYYY-MM-DD format preservation:</strong><br>';

        testDates.forEach((dateStr) => {
          // Old way (problematic)
          const oldWay = new Date(dateStr).toISOString().split('T')[0];

          // New way (our fix)
          const newWay = dateStr.split('T')[0];

          const isCorrect = oldWay === newWay;
          results += `
                    <div style="margin: 5px 0;">
                        Input: ${dateStr}<br>
                        Old way: ${oldWay}<br>
                        New way: ${newWay}<br>
                        <span class="${isCorrect ? 'success' : 'error'}">${isCorrect ? '✓ Correct' : '✗ Timezone shift detected'}</span>
                    </div>
                `;
        });

        document.getElementById('date-format-result').innerHTML = results;
      }

      // Test 3: Calendar date matching (mimicking our calendar grid fix)
      function testCalendarMatching() {
        const taskDate = '2024-01-15';
        const calendarDate = new Date(2024, 0, 15); // January 15, 2024 (month is 0-indexed)

        // Old way (problematic)
        const taskDateOld = new Date(taskDate);
        const oldMatch =
          taskDateOld.getUTCFullYear() === calendarDate.getFullYear() &&
          taskDateOld.getUTCMonth() === calendarDate.getMonth() &&
          taskDateOld.getUTCDate() === calendarDate.getDate();

        // New way (our fix)
        const taskDateParts = taskDate.split('T')[0].split('-');
        const taskYear = parseInt(taskDateParts[0], 10);
        const taskMonth = parseInt(taskDateParts[1], 10) - 1; // Month is 0-indexed
        const taskDay = parseInt(taskDateParts[2], 10);

        const newMatch =
          taskYear === calendarDate.getFullYear() &&
          taskMonth === calendarDate.getMonth() &&
          taskDay === calendarDate.getDate();

        document.getElementById('calendar-match-result').innerHTML = `
                <strong>Testing calendar date matching:</strong><br>
                Task date: ${taskDate}<br>
                Calendar date: ${calendarDate.toDateString()}<br>
                Old way match: <span class="${oldMatch ? 'success' : 'error'}">${oldMatch ? '✓ Match' : '✗ No match'}</span><br>
                New way match: <span class="${newMatch ? 'success' : 'error'}">${newMatch ? '✓ Match' : '✗ No match'}</span>
            `;
      }

      // Test 4: Task date parsing for display
      function testTaskDateParsing() {
        const testDate = '2024-01-15';
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);

        // Our improved formatDate function
        function formatDate(dateString) {
          const dateParts = dateString.split('T')[0].split('-');
          const taskYear = parseInt(dateParts[0], 10);
          const taskMonth = parseInt(dateParts[1], 10) - 1; // Month is 0-indexed
          const taskDay = parseInt(dateParts[2], 10);

          const taskDate = new Date(taskYear, taskMonth, taskDay);
          const todayLocal = new Date(
            today.getFullYear(),
            today.getMonth(),
            today.getDate()
          );
          const tomorrowLocal = new Date(
            tomorrow.getFullYear(),
            tomorrow.getMonth(),
            tomorrow.getDate()
          );

          if (taskDate.getTime() === todayLocal.getTime()) {
            return 'Today';
          } else if (taskDate.getTime() === tomorrowLocal.getTime()) {
            return 'Tomorrow';
          } else {
            const userTimezone =
              Intl.DateTimeFormat().resolvedOptions().timeZone;
            return taskDate.toLocaleDateString('en-US', {
              timeZone: userTimezone,
              month: 'short',
              day: 'numeric',
              year:
                taskDate.getFullYear() !== today.getFullYear()
                  ? 'numeric'
                  : undefined,
            });
          }
        }

        // Test with today's date
        const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
        const tomorrowStr = `${tomorrow.getFullYear()}-${String(tomorrow.getMonth() + 1).padStart(2, '0')}-${String(tomorrow.getDate()).padStart(2, '0')}`;

        document.getElementById('task-parse-result').innerHTML = `
                <strong>Testing task date display:</strong><br>
                Today (${todayStr}): ${formatDate(todayStr)}<br>
                Tomorrow (${tomorrowStr}): ${formatDate(tomorrowStr)}<br>
                Sample date (${testDate}): ${formatDate(testDate)}
            `;
      }

      // Run all tests
      testTimezoneDetection();
      testDateFormatting();
      testCalendarMatching();
      testTaskDateParsing();
    </script>
  </body>
</html>
